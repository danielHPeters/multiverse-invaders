!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=54)}({0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(i=e.EntityType||(e.EntityType={})).PLAYER="ship",i.ENEMY="enemy",i.ENEMY_BULLET="bulletEnemy",i.PLAYER_BULLET="bullet",i.BACKGROUND="background",i.MAP="map",i.GAME_OVER="gameOver",i.LASER="laser",i.MAIN_THEME="shockWave",i.EXPLOSION_I="explosion1",i.EXPLOSION_II="explosion2",i.BOX="box",i.ARENA="arena";var i},1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5);(r=e.Actions||(e.Actions={})).UP="UP",r.DOWN="DOWN",r.LEFT="LEFT",r.RIGHT="RIGHT",r.SHOOT="SHOOT",r.RESTART="RESTART",r.ROTATE_LEFT="R-LEFT",r.ROTATE_RIGHT="R-RIGHT";var r;e.default=class extends i.default{constructor(t){super(),this.inputMap=t.keyBoard,this.init(),this.initializeTouchHandler(),this.touches={start:[],move:[]}}init(){window.addEventListener("keydown",t=>{let e=" "!==t.key?t.key:"space";this.state[this.inputMap[e]]=!0,this.notify()}),window.addEventListener("keyup",t=>{let e=" "!==t.key?t.key:"space";this.state[this.inputMap[e]]=!1,this.notify()})}initializeTouchHandler(){let t=document.getElementById("move"),e=t||window;e.addEventListener("touchstart",l,!1),e.addEventListener("touchmove",c,!1),e.addEventListener("touchend",u,!1),e.addEventListener("contextmenu",t=>(t.preventDefault(),!1));let s=[],i=[],r=0,a=0,o=0,n=0,h=this;function l(t){t.preventDefault(),s=t.touches,r=t.touches[0].pageX,a=t.touches[0].pageY}function c(t){h.reset(),t.preventDefault(),i=t.changedTouches,o=t.touches[0].pageX,n=t.touches[0].pageY;for(let e=0;e<t.touches.length;e++)i[e].pageX<s[e].pageX&&(h.state[h.inputMap.a]=!0),i[e].pageX>s[e].pageX&&(h.state[h.inputMap.d]=!0),i[e].pageY<s[e].pageY&&(h.state[h.inputMap.w]=!0),i[e].pageY>s[e].pageY&&(h.state[h.inputMap.s]=!0),h.notify()}function u(t){t.preventDefault(),h.reset()}}shoot(){this.state[this.inputMap.space]=!0}cancelShoot(){this.state[this.inputMap.space]=!1}reset(){this.state[this.inputMap.w]=!1,this.state[this.inputMap.a]=!1,this.state[this.inputMap.s]=!1,this.state[this.inputMap.d]=!1}}},2:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this.x=t,this.y=e}static addVector(t,e){return new i(t.x+e.x,t.y+e.y)}static subtractVector(t,e){return new i(t.x-e.x,t.y-e.y)}static multiply(t,e){return new i(t.x*e,t.y*e)}static divide(t,e){if(0===e)throw new Error('cannot divide vector by scalar with value "0"');return new i(t.x/e,t.y/e)}set x(t){this._x=t}set y(t){this._y=t}get x(){return this._x}get y(){return this._y}set(t,e){this.x=t,this.y=e}setVector(t){this.x=t.x,this.y=t.y}add(t,e){this.x+=t,this.y+=e}addVector(t){this.x+=t.x,this.y+=t.y}subtract(t,e){this.x-=t,this.y-=e}subtractVector(t){this.x-=t.x,this.y-=t.y}multiply(t){this.x*=t,this.y*=t}divide(t){if(0===t)throw new Error('cannot divide vector by "0"');this.x/=t,this.y/=t}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}negative(){return new i(-this.x,-this.y)}normalize(){let t=this.mag();0!==t&&this.divide(t)}limit(t){Math.floor(this.mag())>t&&(this.normalize(),this.multiply(t))}distanceTo(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}dot(t){return this.x*t.x+this.y*t.y}floor(){this.x=Math.floor(this.x),this.x=Math.floor(this.x)}clone(){return new i(this.x,this.y)}}e.default=i},5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this._observers=[],this._state={}}register(t){this._observers.push(t)}unRegister(t){this._observers=this._observers.filter(e=>e!==t)}notify(){this._observers.forEach(t=>{t.update(this._state)})}get observers(){return this._observers}set observers(t){this._observers=t}get state(){return this._state}set state(t){this._state=t}}},54:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(55),r=s(1),a=s(6),o=s(58),n=new a.default,h=new r.default(n),l=document.getElementById("tetris"),c=new i.default(l);c.addPlayer("p1","Daniel",new o.default(c.arena.matrix.mArray[0].length/2,0)),h.register(c.players[0]),c.start()},55:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(56),r=s(57),a=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"];e.default=class{constructor(t){this.canvas=t,this.context=t.getContext("2d"),this.playing=!1,this.arena=new r.default,this.players=[],this.lastTime=0,this.context.scale(20,20)}addPlayer(t,e,s){this.players.push(new i.default(t,e,s,this.arena))}start(){this.playing=!0,this.run()}drawMatrix(t,e,s){e.forEach((e,i)=>{e.forEach((e,r)=>{0!==e&&(t.fillStyle=a[e],t.fillRect(r+s.x,i+s.y,1,1))})})}animationCallback(t){const e=t-this.lastTime;this.lastTime=t,this.update(e),this.render(),requestAnimationFrame(this.animationCallback.bind(this))}update(t){this.players.forEach(e=>{e.piece.dropCounter+=t,e.piece.dropCounter>e.piece.dropInterval&&e.piece.drop(this.arena,e)})}render(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawMatrix(this.context,this.arena.matrix.mArray,this.arena.postition),this.drawMatrix(this.context,this.players[0].piece.matrix.mArray,this.players[0].piece.position)}run(){requestAnimationFrame(this.animationCallback.bind(this))}stop(){}}},56:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.default=class{constructor(t,e,s,i){this.id=t,this.name=e,this.score=0,this.state={},this.piece=s,this.arena=i}update(t){this.state=t,this.move(this.arena)}move(t){this.state[i.Actions.LEFT]&&this.piece.move(-1),this.state[i.Actions.RIGHT]&&this.piece.move(1),this.state[i.Actions.DOWN]&&this.piece.drop(t,this),this.state[i.Actions.ROTATE_LEFT]&&this.piece.rotate(t,this,-1),this.state[i.Actions.ROTATE_RIGHT]&&this.piece.rotate(t,this,1)}}},57:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(8),r=s(2);e.default=class{constructor(){this.postition=new r.default(0,0),this.init(12,20)}init(t,e){const s=[];for(;e--;)s.push(new Array(t).fill(0));this.matrix=new i.default(s)}sweep(t){let e=1;t:for(let s=this.matrix.mArray.length-1;s>0;--s){for(let t=0;t<this.matrix.mArray[s].length;++t)if(0===this.matrix.mArray[s][t])continue t;const i=this.matrix.mArray.splice(s,1)[0].fill(0);this.matrix.mArray.unshift(i),++s,t.score+=10*e,e*=2}}merge(t){t.piece.matrix.mArray.forEach((e,s)=>{e.forEach((e,i)=>{0!==e&&(this.matrix.mArray[s+t.piece.position.y][i+t.piece.position.x]=e)})})}}},58:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(8),r=s(2),a=s(0),o=s(59);e.types={I:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],L:[[0,2,0],[0,2,0],[0,2,2]],J:[[0,3,0],[0,3,0],[3,3,0]],O:[[4,4],[4,4]],Z:[[5,5,0],[0,5,5],[0,0,0]],S:[[0,6,6],[6,6,0],[0,0,0]],T:[[0,7,0],[7,7,7],[0,0,0]]};e.default=class{constructor(t,e){this.position=new r.default(t,e),this.matrix=new i.default([[0]]),this.setRandom(),this.collidesWith=[],this.collidesWith.push(a.EntityType.ARENA),this.colliding=!1,this.dropCounter=0,this.dropInterval=1e3}move(t){this.position.add(t,0)}rotate(t,e,s){const i=e.piece.position.x;let r=1;for(this.matrix.rotate(s);o.default.detectCollision(t,e);)if(e.piece.position.x+=r,(r=-(r+(r>0?1:-1)))>e.piece.matrix.mArray[0].length)return e.piece.matrix.rotate(-s),void(e.piece.position.x=i)}drop(t,e){this.position.add(0,1),o.default.detectCollision(t,e)&&(this.position.add(0,-1),t.merge(e),this.reset(t,e),t.sweep(e)),this.dropCounter=0}isCollideAbleWith(t){return this.collidesWith.includes(t.type.toString())}setRandom(){this.matrix.set(e.types["TJLOSZI"["TJLOSZI".length*Math.random()|0]])}reset(t,e){this.setRandom(),this.position.set((t.matrix.mArray[0].length/2|0)-(this.matrix.mArray[0].length/2|0),0),o.default.detectCollision(t,e)&&(t.matrix.mArray.forEach(t=>t.fill(0)),e.score=0)}}},59:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static detectCollision(t,e){const s=t.matrix.mArray,i=e.piece.matrix.mArray,r=e.piece.position;for(let t=0;t<i.length;++t)for(let e=0;e<i[t].length;++e)if(0!==i[t][e]&&0!==(s[t+r.y]&&s[t+r.y][e+r.x]))return!0;return!1}}},6:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.default=class{constructor(){this.keyBoard={w:i.Actions.UP,s:i.Actions.DOWN,a:i.Actions.LEFT,d:i.Actions.RIGHT,space:i.Actions.SHOOT,r:i.Actions.RESTART,q:i.Actions.ROTATE_LEFT,e:i.Actions.ROTATE_RIGHT},this.player={maxVelocity:15,fireDelay:15,friction:.7,acceleration:3},this.audio={master:1,ambient:1,effects:1}}findKey(t){return Object.keys(this.keyBoard).filter(e=>this.keyBoard[e]===t)[0]}setKey(t,e){let s=this.findKey(e);t!==s&&(console.log("old:"+s," new: "+t+" value: "+e),this.keyBoard[t]=this.keyBoard[s],delete this.keyBoard[s])}}},8:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.mArray=t,this.rows=t.length,this.columns=t[0].length}set(t){const e=t[0].length;let s=!0;for(let i=1;i<t.length;i++)t[i].length!==e&&(s=!1);if(!s)throw new Error("The passed matrix array is malformed: "+t);this.rows=t.length,this.columns=t[0].length,this.mArray=t}add(t){if(this.equals(t))for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.mArray[e][s]+=t.mArray[e][s]}subtract(t){if(this.equals(t))for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.mArray[e][s]-=t.mArray[e][s]}multiply(t){let e=[];if(this.columns!==t.rows)return null;for(let s=0;s<this.rows;s++){e[s]=[];for(let i=0;i<t.columns;i++){let r=0;for(let e=0;e<this.columns;e++)r+=this.mArray[s][e]*t.mArray[e][i];e[s].push(r)}}return new i(e)}multScalar(t){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.mArray[e][s]*=t}transpose(){let t=[];for(let e=0;e<this.columns;e++){t[e]=[];for(let s=0;s<this.rows;s++)t[e][s]=this.mArray[s][e]}this.rows=t.length,this.columns=t[0].length,this.mArray=t}rotate(t){this.transpose(),t>0?this.mArray.forEach(t=>t.reverse()):this.mArray.reverse()}equals(t){return t.rows===this.rows&&t.columns===this.columns}clone(){let t=[];return this.mArray.forEach(e=>t.push(e.slice(0))),new i(Array.from(t))}}e.default=i}});
//# sourceMappingURL=tetris.min.js.map