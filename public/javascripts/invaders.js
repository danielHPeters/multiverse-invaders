!function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=29)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.PLAYER="ship",t.ENEMY="enemy",t.ENEMY_BULLET="bulletEnemy",t.PLAYER_BULLET="bullet",t.BACKGROUND="background",t.MAP="map",t.GAME_OVER="gameOver",t.LASER="laser",t.MAIN_THEME="shockWave",t.EXPLOSION_I="explosion1",t.EXPLOSION_II="explosion2",t.BOX="box",t.ARENA="arena"}(e.EntityType||(e.EntityType={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.MAIN=1]="MAIN",t[t.SHIP=2]="SHIP"}(e.ContextId||(e.ContextId={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this.x=t,this.y=e}static addVector(t,e){return new i(t.x+e.x,t.y+e.y)}static subtractVector(t,e){return new i(t.x-e.x,t.y-e.y)}static multiply(t,e){return new i(t.x*e,t.y*e)}static divide(t,e){if(0===e)throw new Error('cannot divide vector by scalar with value "0"');return new i(t.x/e,t.y/e)}set x(t){this._x=t}set y(t){this._y=t}get x(){return this._x}get y(){return this._y}set(t,e){this.x=t,this.y=e}setVector(t){this.x=t.x,this.y=t.y}add(t,e){this.x+=t,this.y+=e}addVector(t){this.x+=t.x,this.y+=t.y}subtract(t,e){this.x-=t,this.y-=e}subtractVector(t){this.x-=t.x,this.y-=t.y}multiply(t){this.x*=t,this.y*=t}divide(t){if(0===t)throw new Error('cannot divide vector by "0"');this.x/=t,this.y/=t}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}negative(){return new i(-this.x,-this.y)}normalize(){let t=this.mag();0!==t&&this.divide(t)}limit(t){Math.floor(this.mag())>t&&(this.normalize(),this.multiply(t))}distanceTo(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}dot(t){return this.x*t.x+this.y*t.y}floor(){this.x=Math.floor(this.x),this.x=Math.floor(this.x)}clone(){return new i(this.x,this.y)}}e.default=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.width=t,this.height=e}scale(t){this.width*=t,this.height*=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,s){this.position=t,this.dimension=e,this.settings=s}init(){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.PLAYER="ship",t.ENEMY="enemy",t.ENEMY_BULLET="bulletEnemy",t.PLAYER_BULLET="bullet",t.BACKGROUND="background",t.MAP="map",t.GAME_OVER="gameOver",t.LASER="laser",t.MAIN_THEME="shockWave",t.EXPLOSION_I="explosion1",t.EXPLOSION_II="explosion2",t.BOX="box",t.ARENA="arena"}(e.AssetId||(e.AssetId={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(10);!function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT",t.SHOOT="SHOOT",t.RESTART="RESTART",t.ROTATE_LEFT="R-LEFT",t.ROTATE_RIGHT="R-RIGHT"}(e.Actions||(e.Actions={}));e.default=class extends i.default{constructor(t){super(),this.inputMap=t.keyboard,this.init(),this.initializeTouchHandler(),this.touches={start:[],move:[]}}init(){window.addEventListener("keydown",t=>{let e=" "!==t.key?t.key:"space";this.state[this.inputMap[e]]=!0,this.notify()}),window.addEventListener("keyup",t=>{let e=" "!==t.key?t.key:"space";this.state[this.inputMap[e]]=!1,this.notify()})}initializeTouchHandler(){let t=document.getElementById("move"),e=t||window;e.addEventListener("touchstart",function(t){t.preventDefault(),s=t.touches,o=t.touches[0].pageX,n=t.touches[0].pageY},!1),e.addEventListener("touchmove",function(t){r.reset(),t.preventDefault(),i=t.changedTouches,a=t.touches[0].pageX,h=t.touches[0].pageY;for(let e=0;e<t.touches.length;e++)i[e].pageX<s[e].pageX&&(r.state[r.inputMap.a]=!0),i[e].pageX>s[e].pageX&&(r.state[r.inputMap.d]=!0),i[e].pageY<s[e].pageY&&(r.state[r.inputMap.w]=!0),i[e].pageY>s[e].pageY&&(r.state[r.inputMap.s]=!0),r.notify()},!1),e.addEventListener("touchend",function(t){t.preventDefault(),r.reset()},!1),e.addEventListener("contextmenu",t=>(t.preventDefault(),!1));let s=[],i=[],o=0,n=0,a=0,h=0,r=this}shoot(){this.state[this.inputMap.space]=!0}cancelShoot(){this.state[this.inputMap.space]=!1}reset(){this.state[this.inputMap.w]=!1,this.state[this.inputMap.a]=!1,this.state[this.inputMap.s]=!1,this.state[this.inputMap.d]=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(25),o=s(24);var n;!function(t){t.SPRITE="SPRITE",t.SPRITE_SHEET="SPRITE_SHEET",t.AUDIO="AUDIO",t.AUDIO_AMB="LOOP"}(n=e.AssetType||(e.AssetType={}));e.default=class{constructor(t){this.cache={sprites:{},spriteSheets:{},audio:{}},this.downloadCount=0,this.queue=[],this.audioManager=t}done(){return this.downloadCount===this.queue.length}queueDownload(t,e,s,i=null){this.queue.push({id:t,path:e,type:s,opts:i})}loadAudio(t,e){o.default.create({method:"GET",url:t.path,responseType:"arraybuffer"},s=>{this.audioManager.decodeAudio(s,t.id,s=>{this.cache.audio[t.id]=s,this.downloadCount+=1,this.done()&&e()})})}loadSprite(t,e){let s=new Image;s.addEventListener("load",()=>{this.downloadCount++,this.done()&&e()}),s.src=t.path,this.cache.sprites[t.id]=s}loadSpriteSheet(t,e){let s=new Image;s.addEventListener("load",()=>{this.cache.spriteSheets[t.id]=new i.default(s,t.opts.frameWidth||0,t.opts.frameHeight||0),this.downloadCount+=1,this.done()&&e()}),s.src=t.path}downloadAll(t){this.queue.forEach(e=>{e.type===n.AUDIO?this.loadAudio(e,t):e.type===n.SPRITE?this.loadSprite(e,t):e.type===n.SPRITE_SHEET&&this.loadSpriteSheet(e,t)})}getSound(t,e){let s=e===n.AUDIO_AMB;return this.audioManager.createSound(this.cache.audio[t],s)}getSprite(t){return this.cache.sprites[t]}getSpriteSheet(t){return this.cache.spriteSheets[t]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),o=s(0);e.default=class{constructor(t,e,s,n){this.position=new i.default(t,e),this.width=s,this.height=n,this.colliding=!1,this.collidesWith=[],this.type=o.EntityType.BOX,this.collidesWith.push(o.EntityType.PLAYER)}isCollideAbleWith(t){return this.collidesWith.includes(t.type.toString())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static register(t,e,s){e.forEach(e=>t.addEventListener(e,s))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this._observers=[],this._state={}}register(t){this._observers.push(t)}unRegister(t){this._observers=this._observers.filter(e=>e!==t)}notify(){this._observers.forEach(t=>{t.update(this._state)})}get observers(){return this._observers}set observers(t){this._observers=t}get state(){return this._state}set state(t){this._state=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,s,i,o){this.state=t,this.assetManager=e,this.inputManager=s,this.settings=i,this.contexts=o,this.init()}init(){this.contexts.forEach(t=>t.clearRect(0,0,this.settings.gameSize.width,this.settings.gameSize.height)),this.state.reset()}clear(){this.state.renderables.forEach(t=>t.clear(this.contexts.get(t.contextId)))}render(){this.state.renderables.forEach(t=>t.render(this.contexts.get(t.contextId)))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(6);e.default=class{constructor(t){this.game=t,this.lastTime=null,this.state={}}start(){this.game.init(),this.game.state.running=!0,this.frameId=requestAnimationFrame(t=>this.loop(t))}stop(){this.frameId&&cancelAnimationFrame(this.frameId)}restart(){this.stop(),this.start()}togglePause(){this.game.state.paused=!this.game.state.paused}loop(t){if(this.state[i.Actions.RESTART])this.restart();else if(this.game.state.running){if(this.game.clear(),null!==this.lastTime){const e=t-this.lastTime;this.game.state.paused||this.game.state.update(e/1e3)}this.lastTime=t,this.game.render(),this.frameId=requestAnimationFrame(t=>this.loop(t))}}update(t){this.state=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.quadTree=t}detectCollision(){let t=[];this.quadTree.getAllObjects(t);for(let e=0;e<t.length;e++){let s=[];this.quadTree.findObjects(s,t[e]);for(let i=0;i<s.length;i++)t[e].isCollideAbleWith(s[i])&&Math.floor(t[e].position.x)<Math.floor(s[i].position.x)+s[i].dimension.width&&Math.floor(t[e].position.x)+t[e].dimension.width>Math.floor(s[i].position.x)&&Math.floor(t[e].position.y)<Math.floor(s[i].position.y)+s[i].dimension.height&&Math.floor(t[e].position.y)+t[e].dimension.height>Math.floor(s[i].position.y)&&t[e].alive&&s[i].alive&&(console.log(t[e]),t[e].colliding=!0,s[i].colliding=!0)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),o=s(0),n=s(4),a=s(3),h=s(1);e.default=class extends n.default{constructor(t,e,s,n,r,l,d,u){super(new i.default(0,0),new a.default(t,e),l),this.velocity=new i.default(0,0),this.sprite=s,this.percentFire=.001,this.chance=0,this.alive=!1,this.type=n,this.collidesWith=[],this.collidesWith.push(o.EntityType.PLAYER_BULLET),this.colliding=!1,this.bulletPool=r,this.contextId=h.ContextId.MAIN,this.explosionSound=d,this.game=u}init(){this.position.set(0,0),this.velocity.set(0,0),this.speed=0,this.alive=!1,this.colliding=!1}fire(){this.bulletPool.get(Math.floor(this.position.x+this.dimension.width/2),Math.floor(this.position.y+this.dimension.height),-200)}render(t){this.alive&&t.drawImage(this.sprite,this.position.x,this.position.y)}clear(t){t.clearRect(this.position.x-1,this.position.y,this.dimension.width+1,this.dimension.height)}move(t){this.colliding?(this.game.scorePoints(),this.explosionSound.play(),this.alive=!1):this.alive&&(this.position.addVector(this.velocity),this.position.x<=this.leftEdge?this.velocity.x=this.speed:this.position.x>=this.rightEdge+this.dimension.width?this.velocity.x=-this.speed:this.position.y>=this.bottomEdge&&(this.speed=1.5,this.velocity.y=0,this.position.y-=5,this.velocity.x=-this.speed),this.chance=Math.floor(101*Math.random()),this.chance/100<this.percentFire&&this.fire())}spawn(t,e,s){this.position.set(t,e),this.velocity.set(0,s),this.speed=s,this.alive=!0,this.leftEdge=this.position.x-180,this.rightEdge=this.position.x+180,this.bottomEdge=this.position.y+280}isCollideAbleWith(t){return this.collidesWith.includes(t.type.toString())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),o=s(0),n=s(4),a=s(3),h=s(1);e.default=class extends n.default{constructor(t,e,s,n,r){super(new i.default(0,0),new a.default(t,e),r),this.speed=0,this.sprite=s,this.alive=!1,this.type=n,this.colliding=!1,this.collidesWith=[],this.type===o.EntityType.PLAYER_BULLET?this.collidesWith.push(o.EntityType.ENEMY):this.type===o.EntityType.ENEMY_BULLET&&this.collidesWith.push(o.EntityType.PLAYER),this.settings=r,this.contextId=h.ContextId.MAIN}init(){this.position.set(0,0),this.speed=0,this.alive=!1,this.colliding=!1}spawn(t,e,s){this.position.set(t,e),this.speed=s,this.alive=!0}render(t){this.type===o.EntityType.PLAYER_BULLET&&this.position.y<=0-this.dimension.height||this.type===o.EntityType.ENEMY_BULLET&&this.position.y>=this.settings.gameSize.height?this.alive=!1:t.drawImage(this.sprite,this.position.x,this.position.y)}clear(t){t.clearRect(this.position.x-1,this.position.y-1,this.dimension.width+1,this.dimension.height+1)}move(t){this.type===o.EntityType.PLAYER_BULLET&&this.position.y<=0-this.dimension.height||this.type===o.EntityType.ENEMY_BULLET&&this.position.y>=this.settings.gameSize.height||this.colliding?(this.alive=!1,this.colliding=!1):this.position.y-=Math.floor(this.speed*t)}isCollideAbleWith(t){return this.collidesWith.includes(t.type.toString())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(7),o=s(15),n=s(14),a=s(0),h=s(5),r=s(1);e.default=class{constructor(t,e,s,i,o,n=null,a=null){this.assetManager=t,this.maxSize=e,this.type=s,this.assetId=i,this.pool=[],this.subPool=n,this.settings=o,this.contextId=r.ContextId.MAIN,this.game=a,this.init()}init(){const t=this.assetManager.getSprite(this.assetId);if(this.type===a.EntityType.ENEMY)for(let e=0;e<this.maxSize;e++)this.pool[e]=new n.default(t.width,t.height,t,this.type,this.subPool,this.settings,this.assetManager.getSound(h.AssetId.EXPLOSION_I,i.AssetType.AUDIO),this.game);else for(let e=0;e<this.maxSize;e++)this.pool[e]=new o.default(t.width,t.height,t,this.type,this.settings)}getPool(){return this.pool.filter(t=>t.alive)}get(t,e,s){const i=this.pool[this.maxSize-1];i.alive||(i.spawn(t,e,s),this.pool.unshift(this.pool.pop()))}getTwo(t,e,s,i,o,n){this.pool[this.maxSize-1].alive||this.pool[this.maxSize-2].alive||(this.get(t,e,s),this.get(i,o,n))}render(t){for(let e=0;e<this.pool.length;e++)this.pool[e].alive?this.pool[e].render(t):(this.pool[e].init(),this.pool.push(this.pool.splice(e,1)[0]))}clear(t){this.pool.forEach(e=>e.clear(t))}move(t){this.pool.forEach(e=>e.move(t))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),o=s(1),n=s(4),a=s(3);e.default=class extends n.default{constructor(t,e,s,n){super(new i.default(0,0),new a.default(t,e),n),this.speed=1,this.sprite=s,this.contextId=o.ContextId.BACKGROUND}init(){this.position.set(0,0)}render(t){t.drawImage(this.sprite,this.position.x,this.position.y),t.drawImage(this.sprite,this.position.x,this.position.y-this.dimension.height)}move(t){this.position.y+=this.speed,this.position.y>=this.dimension.height&&(this.position.y=0)}clear(){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),o=s(0),n=s(6),a=s(7),h=s(5),r=s(4),l=s(3),d=s(1);e.default=class extends r.default{constructor(t,e,s,n,r){super(new i.default(0,0),new l.default(t,e),r),this.startPosition=new i.default(0,0),this.acceleration=new i.default(0,0),this.velocity=new i.default(0,0),this.sprite=s.getSprite(h.AssetId.PLAYER),this.type=o.EntityType.PLAYER,this.bulletPool=n,this.counter=0,this.collidesWith=[],this.collidesWith.push(o.EntityType.ENEMY_BULLET),this.colliding=!1,this.state={},this.settings=r,this.assetManager=s,this.maxTop=Math.floor(this.settings.gameSize.height/4*3),this.laserSound=s.getSound(h.AssetId.LASER,a.AssetType.AUDIO),this.contextId=d.ContextId.SHIP,this.alive=!1}init(){const t=this.settings.gameSize.width/2-this.assetManager.getSprite(h.AssetId.PLAYER).width,e=this.settings.gameSize.height/4*3+2*this.assetManager.getSprite(h.AssetId.PLAYER).height;this.position.setVector(new i.default(t,e)),this.velocity.set(0,0),this.colliding=!1,this.alive=!0}fire(){this.bulletPool.getTwo(Math.floor(this.position.x)+12,Math.floor(this.position.y),200,Math.floor(this.position.x)+66,Math.floor(this.position.y),200),this.laserSound.play()}render(t){this.colliding||t.drawImage(this.sprite,Math.floor(this.position.x),Math.floor(this.position.y))}clear(t){t.clearRect(Math.floor(this.position.x),Math.floor(this.position.y),this.dimension.width,this.dimension.height)}move(t){if(!this.colliding){this.counter++,this.acceleration.set(0,0),this.state[n.Actions.LEFT]&&this.acceleration.add(-this.settings.player.acceleration,0),this.state[n.Actions.RIGHT]&&this.acceleration.add(this.settings.player.acceleration,0),this.state[n.Actions.UP]&&this.acceleration.add(0,-this.settings.player.acceleration),this.state[n.Actions.DOWN]&&this.acceleration.add(0,this.settings.player.acceleration),this.velocity.multiply(this.settings.player.friction),this.velocity.addVector(this.acceleration),this.velocity.limit(this.settings.player.maxVelocity);const e=this.velocity.clone();e.multiply(t),this.position.addVector(e),this.position.x<=0&&(this.position.x=0,this.velocity.x+=-1),this.position.x>=this.settings.gameSize.width-this.dimension.width&&(this.position.x=this.settings.gameSize.width-this.dimension.width),this.position.y<=this.maxTop&&(this.position.y=this.maxTop),this.position.y>=this.settings.gameSize.height-this.dimension.height&&(this.position.y=this.settings.gameSize.height-this.dimension.height),this.state[n.Actions.SHOOT]&&this.counter>=this.settings.player.fireDelay&&(this.fire(),this.counter=0)}}update(t){this.state=t}isCollideAbleWith(t){return this.collidesWith.includes(t.type.toString())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(8);class o{constructor(t=new i.default(0,0,0,0),e=0){this.level=e,this.maxObjects=10,this.maxLevels=5,this.hitBox=t,this.objects=[],this.nodes=[]}clear(){this.objects=[],this.nodes.forEach(t=>t.clear()),this.nodes=[]}getAllObjects(t){return this.nodes.forEach(e=>e.getAllObjects(t)),this.objects.forEach(e=>t.push(e)),t}findObjects(t,e){if(void 0===e)return void console.log("UNDEFINED OBJECT");let s=this.getIndex(e);return-1!==s&&this.nodes.length&&this.nodes[s].findObjects(t,e),this.objects.forEach(e=>t.push(e)),t}insert(t){if(void 0!==t)if(t instanceof Array)t.forEach(t=>this.insert(t));else{if(this.nodes.length>0){let e=this.getIndex(t);if(-1!==e)return void this.nodes[e].insert(t)}if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){void 0===this.nodes[0]&&this.split();let t=0;for(;t<this.objects.length;){let e=this.getIndex(this.objects[t]);-1!==e?this.nodes[e].insert(this.objects.splice(t,1)[0]):t++}}}}getIndex(t){let e=-1,s=this.hitBox.position.x+this.hitBox.width/2,i=this.hitBox.position.y+this.hitBox.height/2,o=t.position.y<i&&t.position.y+t.height<i,n=t.position.y>i;return t.position.x<s&&t.position.x+t.width<s?o?e=1:n&&(e=2):t.position.x>s&&(o?e=0:n&&(e=3)),e}split(){let t=this.hitBox.width/2|0,e=this.hitBox.height/2|0;this.nodes[0]=new o(new i.default(this.hitBox.position.x+t,this.hitBox.position.y,t,e),this.level+1),this.nodes[1]=new o(new i.default(this.hitBox.position.x,this.hitBox.position.y,t,e),this.level+1),this.nodes[2]=new o(new i.default(this.hitBox.position.x,this.hitBox.position.y+e,t,e),this.level+1),this.nodes[3]=new o(new i.default(this.hitBox.position.x+t,this.hitBox.position.y+e,t,e),this.level+1)}}e.default=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),o=s(19),n=s(7),a=s(18),h=s(8),r=s(5),l=s(17),d=s(16),u=s(13),c=s(10);e.default=class extends c.default{constructor(t,e,s){super(),this.assetManager=s,this.quadTree=new o.default(new h.default(0,0,t.gameSize.width,t.gameSize.height)),this.collisionManager=new u.default(this.quadTree),this.running=!1,this.paused=!1,this.playerScore=0;const c=new l.default(t.gameSize.width,t.gameSize.height,s.getSprite(r.AssetId.BACKGROUND),t),p=new d.default(this.assetManager,80,i.EntityType.PLAYER_BULLET,r.AssetId.PLAYER_BULLET,t),g=new a.default(s.getSprite(r.AssetId.PLAYER).width,s.getSprite(r.AssetId.PLAYER).height,s,p,t),f=new d.default(this.assetManager,50,i.EntityType.ENEMY_BULLET,r.AssetId.ENEMY_BULLET,t),y=new d.default(this.assetManager,30,i.EntityType.ENEMY,r.AssetId.ENEMY,t,f,this);this.pools=[],this.entities=[],this.renderables=[],this.collideables=[],this.movables=[],this.pools.push(p),this.pools.push(f),this.pools.push(y),this.entities.push(g),this.entities.push(c),y.pool.forEach(t=>this.entities.push(t)),f.pool.forEach(t=>this.entities.push(t)),p.pool.forEach(t=>this.entities.push(t)),this.collideables.push(g),y.pool.forEach(t=>this.collideables.push(t)),f.pool.forEach(t=>this.collideables.push(t)),p.pool.forEach(t=>this.collideables.push(t)),this.movables.push(g),this.movables.push(c),this.movables.push(y),this.movables.push(p),this.movables.push(f),this.renderables.push(g),this.renderables.push(c),this.renderables.push(p),this.renderables.push(f),this.renderables.push(y),this.backgroundAudio=this.assetManager.getSound(r.AssetId.MAIN_THEME,n.AssetType.AUDIO_AMB),this.gameOverAudio=this.assetManager.getSound(r.AssetId.GAME_OVER,n.AssetType.AUDIO_AMB),e.register(g)}update(t){this.spawnWave(),this.quadTree.clear(),this.quadTree.insert(this.collideables),this.collisionManager.detectCollision(),this.movables.forEach(e=>e.move(t))}spawnWave(){if(0===this.pools[2].getPool().length){const t=this.assetManager.getSprite(r.AssetId.ENEMY).height,e=this.assetManager.getSprite(r.AssetId.ENEMY).width;let s=200,i=-t;const o=1.5*i;for(let t=1;t<=21;t++)this.pools[2].get(s,i,300),s+=e+25,t%7==0&&(s=200,i+=o)}}scorePoints(){this.playerScore+=10,this.state=this.playerScore,this.notify()}gameOver(){this.backgroundAudio.stop(),document.getElementById("game-over").style.display="block",this.gameOverAudio=this.assetManager.getSound(r.AssetId.GAME_OVER,n.AssetType.AUDIO_AMB),this.gameOverAudio.play(!0)}reset(){this.backgroundAudio.stop(),this.gameOverAudio.stop(),document.getElementById("game-over").style.display="none",this.quadTree.clear(),this.entities.forEach(t=>t.init()),this.spawnWave(),this.playerScore=0,this.state=this.playerScore,this.notify(),this.backgroundAudio.play(!0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(9);var o;!function(t){t.TAB="tab",t.TAB_CONTENT="tabContent",t.TAB_LINK="tabLink",t.ACTIVE="active"}(o||(o={}));e.default=class{constructor(t,e,s,i){this.element=document.getElementById(t),this.settings=e,this.assetManager=s,this.audioManager=i,this.visible=!1}init(){this.createMainMenu(),this.createKeyboardMenu("keyboardMenu","Keyboard","Keyboard Settings"),this.createPlayerMenu("playerMenu","Player","Player Settings"),this.createAudioMenu("audioMenu","Audio","Audio Settings")}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.init()}toggleShow(){this.element.style.display=this.visible?"none":"block",this.visible=!this.visible}createMainMenu(){this.mainMenu=document.createElement("div"),this.mainMenu.classList.add(o.TAB),this.element.appendChild(this.mainMenu)}createKeyboardMenu(t,e,s){this.createTab(t,e,s,t=>{Object.keys(this.settings.keyboard).forEach(e=>this.addEntry(this.settings.keyboard[e],e,"text",this.settings.keyboard[e],t,t=>this.settings.setKey(t.value,t.id)))})}createPlayerMenu(t,e,s){this.createTab(t,e,s,t=>{Object.keys(this.settings.player).forEach(e=>this.addEntry(e,this.settings.player[e],"number",e,t,t=>this.settings.player[e]=Number(t.value)))})}createAudioMenu(t,e,s){this.createTab(t,e,s,t=>{this.addEntry("masterVolume",1,"range","Master Volume:",t,t=>this.audioManager.adjustMasterVolume(Number(t.value))),this.addEntry("ambientVolume",1,"range","Ambient Volume:",t,t=>this.audioManager.adjustAmbientVolume(Number(t.value))),this.addEntry("effectsVolume",1,"range","Effects Volume:",t,t=>this.audioManager.adjustEffectsVolume(Number(t.value)))})}openTab(t,e){let s,i;s=document.getElementsByClassName(o.TAB_CONTENT);for(let t=0;t<s.length;t++)s[t].style.display="none";i=document.getElementsByClassName(o.TAB_LINK);for(let t=0;t<i.length;t++)i[t].className=i[t].className.replace(" "+o.ACTIVE,"");document.getElementById(e).style.display="block",t.currentTarget.className+=" "+o.ACTIVE}createTab(t,e,s,n){const a=document.createElement("div"),h=document.createElement("button"),r=document.createElement("h4");i.default.register(h,["click","touchstart"],e=>this.openTab(e,t)),h.textContent=e,h.classList.add(o.TAB_LINK),a.id=t,a.classList.add(o.TAB_CONTENT),a.appendChild(r),r.textContent=s,this.mainMenu.appendChild(h),this.element.appendChild(a),n(a)}addEntry(t,e,s,i,o,n,a={min:0,max:1,step:.1}){const h=document.createElement("div"),r=document.createElement("label"),l=document.createElement("input");h.classList.add("row"),r.setAttribute("for",t),r.textContent=i,l.id=t,l.name=t,l.value=e,l.type=s,"range"===s&&(l.min=a.min.toString(),l.max=a.max.toString(),l.step=a.step.toString()),"number"===s&&(l.step=a.step.toString()),l.addEventListener("change",t=>n(l)),h.appendChild(r),h.appendChild(l),o.appendChild(h)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(6);e.default=class{constructor(t){this.keyboard={w:i.Actions.UP,s:i.Actions.DOWN,a:i.Actions.LEFT,d:i.Actions.RIGHT,space:i.Actions.SHOOT,r:i.Actions.RESTART},this.player={maxVelocity:150,fireDelay:15,friction:.9,acceleration:50},this.audio={master:1,ambient:1,effects:1},this.gameSize=t}findKey(t){return Object.keys(this.keyboard).filter(e=>this.keyboard[e]===t)[0]}setKey(t,e){let s=this.findKey(e);t!==s&&(console.log("old:"+s," new: "+t+" value: "+e),this.keyboard[t]=this.keyboard[s],delete this.keyboard[s])}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.scoreElement=document.getElementById("score")}update(t){this.scoreElement.innerHTML=t.toString()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static create(t,e){let s=new XMLHttpRequest;s.addEventListener("load",()=>{e(s.response)}),s.open(t.method?t.method:i.defaults.method,t.url?t.url:i.defaults.url,t.async?t.async:i.defaults.async),t.hasOwnProperty("contentType")&&s.setRequestHeader("Content-Type",t.contentType?t.contentType:i.defaults.contentType),t.hasOwnProperty("responseType")&&(s.responseType=t.responseType),t.hasOwnProperty("data")&&"object"==typeof t.data&&(t.data=JSON.stringify(t.data)),s.send(t.data?t.data:null)}}i.defaults={url:"",method:"GET",contentType:"text/html",async:!0,data:null},e.default=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,s){this._image=t,this._frameWidth=e,this._frameHeight=s,this._framesPerRow=Math.floor(this._image.width/this._frameWidth)}get image(){return this._image}set image(t){if(!(t instanceof Image))throw new Error("Param tileSetImage must be of type Image!");this._image=t}get frameWidth(){return this._frameWidth}set frameWidth(t){this._frameWidth=t}get frameHeight(){return this._frameHeight}set frameHeight(t){this._frameHeight=t}get framesPerRow(){return this._framesPerRow}set framesPerRow(t){this._framesPerRow=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,s){this.audioContext=t,this.masterGain=e,this.buffer=s,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=.2,this.gainNode.connect(this.masterGain),this.playing=!1}play(t=!1){this.source=this.audioContext.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=t,this.source.connect(this.gainNode),this.source.start(0)}stop(){this.source&&this.source.stop(0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(26);e.default=class{constructor(){this.initAudioContext()}initAudioContext(){try{window.AudioContext=window.AudioContext||webkitAudioContext,this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.effectsGain=this.audioContext.createGain(),this.ambientGain=this.audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.audioContext.destination),this.effectsGain.connect(this.masterGain),this.ambientGain.connect(this.masterGain),this.ambientGain.gain.value=1,this.effectsGain.gain.value=1}catch(t){console.log("Web Audio API is not supported in this browser")}}decodeAudio(t,e,s){this.audioContext.decodeAudioData(t).then(t=>s(t),t=>{console.log("Error with decoding audio data"+t)})}adjustMasterVolume(t){this.masterGain.gain.value=t}adjustAmbientVolume(t){this.ambientGain.gain.value=t}adjustEffectsVolume(t){this.effectsGain.gain.value=t}createSound(t,e){return new i.default(this.audioContext,e?this.ambientGain:this.effectsGain,t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(27),o=s(7),n=s(23),a=s(22),h=s(21),r=s(6),l=s(1),d=s(3),u=s(5),c=s(20),p=s(12),g=s(9),f=s(11);class y{constructor(){const t=document.getElementById("background");this.contexts=new Map,this.audioManager=new i.default,this.assetManager=new o.default(this.audioManager),this.gui=new n.default,this.settings=new a.default(new d.default(t.width,t.height)),this.inputManager=new r.default(this.settings)}static bootstrap(){return new y}init(){this.initContexts(),this.initAssetQueue(),this.assetManager.downloadAll(()=>this.setUpGame())}initContexts(){const t=document.getElementById("background"),e=document.getElementById("ship"),s=document.getElementById("main");this.contexts.set(l.ContextId.BACKGROUND,t.getContext("2d")),this.contexts.set(l.ContextId.SHIP,e.getContext("2d")),this.contexts.set(l.ContextId.MAIN,s.getContext("2d"))}initAssetQueue(){this.assetManager.queueDownload(u.AssetId.BACKGROUND,"assets/textures/background.png",o.AssetType.SPRITE),this.assetManager.queueDownload(u.AssetId.PLAYER,"assets/sprites/ship.png",o.AssetType.SPRITE),this.assetManager.queueDownload(u.AssetId.PLAYER_BULLET,"assets/sprites/bullet.png",o.AssetType.SPRITE),this.assetManager.queueDownload(u.AssetId.ENEMY,"assets/sprites/enemy.png",o.AssetType.SPRITE),this.assetManager.queueDownload(u.AssetId.ENEMY_BULLET,"assets/sprites/bullet_enemy.png",o.AssetType.SPRITE),this.assetManager.queueDownload(u.AssetId.MAIN_THEME,"assets/audio/kick_shock.wav",o.AssetType.AUDIO),this.assetManager.queueDownload(u.AssetId.LASER,"assets/audio/laser.wav",o.AssetType.AUDIO),this.assetManager.queueDownload(u.AssetId.EXPLOSION_I,"assets/audio/explosion.wav",o.AssetType.AUDIO),this.assetManager.queueDownload(u.AssetId.GAME_OVER,"assets/audio/game_over.wav",o.AssetType.AUDIO)}initTouchControlElements(){const t=document.getElementById("shoot");t.addEventListener("touchstart",()=>this.inputManager.shoot()),t.addEventListener("touchend",()=>this.inputManager.cancelShoot()),t.addEventListener("contextmenu",t=>(t.preventDefault(),!1))}initGui(t){const e=new h.default("settings-menu",this.settings,this.assetManager,this.audioManager),s=document.getElementById("game-over"),i=document.getElementById("settings"),o=["click","touchstart"];e.init(),this.initTouchControlElements(),g.default.register(s,o,()=>t.restart()),g.default.register(i,o,()=>{e.toggleShow(),t.togglePause()})}setUpGame(){const t=new c.default(this.settings,this.inputManager,this.assetManager),e=new f.default(t,this.assetManager,this.inputManager,this.settings,this.contexts),s=new p.default(e);this.inputManager.register(s),this.initGui(s),t.register(this.gui),s.start()}}e.default=y},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(28);document.addEventListener("DOMContentLoaded",()=>i.default.bootstrap().init())}]);
//# sourceMappingURL=invaders.js.map